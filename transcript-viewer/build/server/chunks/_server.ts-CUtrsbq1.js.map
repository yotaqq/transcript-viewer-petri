{"version":3,"file":"_server.ts-CUtrsbq1.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/transcripts/_server.ts.js"],"sourcesContent":["import { error, json } from \"@sveltejs/kit\";\nimport path from \"path\";\nimport { T as TRANSCRIPT_DIR, g as getTranscriptCache } from \"../../../../chunks/transcript-cache.js\";\nfunction validateFilePath(filePath) {\n  if (!filePath || typeof filePath !== \"string\") {\n    return false;\n  }\n  const normalized = path.normalize(filePath);\n  if (normalized.includes(\"../\") || normalized.startsWith(\"/\")) {\n    return false;\n  }\n  if (normalized.includes(\"\\0\")) {\n    return false;\n  }\n  if (!normalized.endsWith(\".json\")) {\n    return false;\n  }\n  const filename = path.basename(normalized);\n  if (!filename.startsWith(\"transcript_\")) {\n    return false;\n  }\n  return true;\n}\nconst GET = async ({ url }) => {\n  try {\n    const filePath = url.searchParams.get(\"filePath\");\n    const metadataOnly = url.searchParams.get(\"metadataOnly\") === \"true\";\n    if (!filePath) {\n      throw error(400, {\n        message: \"Missing required parameter: filePath\"\n      });\n    }\n    const resolvedPath = path.resolve(TRANSCRIPT_DIR, filePath);\n    if (!validateFilePath(filePath)) {\n      throw error(400, {\n        message: `Invalid or unsafe file path: ${filePath}`\n      });\n    }\n    const cache = getTranscriptCache();\n    if (metadataOnly) {\n      const metadata = await cache.getMetadata(resolvedPath);\n      if (metadata === null) {\n        throw error(404, {\n          message: `Transcript not found: ${filePath}`\n        });\n      }\n      return json({\n        success: true,\n        data: metadata\n      }, {\n        headers: {\n          \"Cache-Control\": \"public, max-age=300\"\n          // 5 minutes browser cache for metadata\n        }\n      });\n    } else {\n      const transcript = await cache.getFullTranscript(resolvedPath);\n      if (transcript === null) {\n        throw error(404, {\n          message: `Transcript not found: ${filePath}`\n        });\n      }\n      return json({\n        success: true,\n        data: transcript\n      }, {\n        headers: {\n          \"Cache-Control\": \"public, max-age=60\"\n          // 1 minute browser cache for full transcripts\n        }\n      });\n    }\n  } catch (err) {\n    if (err.status) {\n      throw err;\n    }\n    if (err?.code === \"TRANSCRIPT_VALIDATION_FAILED\" && err.validation) {\n      const { errors: validationErrors } = err.validation;\n      const details = validationErrors?.map?.((e, i) => {\n        const path2 = e.path || \"root\";\n        return `${i + 1}. ${path2}: ${e.message}`;\n      })?.join(\"\\n\");\n      console.error(\"Transcript validation error:\", details);\n      throw error(422, {\n        message: \"Transcript schema validation failed\",\n        details\n      });\n    }\n    console.error(\"Transcript API error:\", err);\n    throw error(500, {\n      message: \"Internal server error while loading transcript\"\n    });\n  }\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}