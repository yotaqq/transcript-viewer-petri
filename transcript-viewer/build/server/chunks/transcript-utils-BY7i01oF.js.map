{"version":3,"file":"transcript-utils-BY7i01oF.js","sources":["../../../.svelte-kit/adapter-node/chunks/transcript-utils.js"],"sourcesContent":["function extractSystemPrompt(transcript) {\n  if (!transcript?.events || !Array.isArray(transcript.events)) {\n    console.warn(\"extractSystemPrompt: transcript.events is not a valid array:\", transcript?.events);\n    return void 0;\n  }\n  for (const event of transcript.events) {\n    if (event.type === \"transcript_event\") {\n      if (event.edit.operation === \"add\" && event.edit.message?.role === \"system\") {\n        const content = event.edit.message.content;\n        return typeof content === \"string\" ? content : JSON.stringify(content);\n      }\n    }\n  }\n  return void 0;\n}\nfunction extractTargetModel(transcript) {\n  if (transcript.metadata.target_model && transcript.metadata.target_model !== \"unknown\") {\n    return transcript.metadata.target_model;\n  }\n  const systemPrompt = extractSystemPrompt(transcript);\n  if (systemPrompt) {\n    const match = systemPrompt.match(/The target AI is a `([^`]+)` model/);\n    if (match && match[1]) {\n      return match[1];\n    }\n  }\n  return \"unknown\";\n}\nfunction extractModelName(targetModel) {\n  if (!targetModel || targetModel === \"unknown\") {\n    return \"unknown\";\n  }\n  const parts = targetModel.split(\":\");\n  if (parts.length > 1) {\n    return parts[1];\n  }\n  return targetModel;\n}\nfunction extractFirstSentence(text) {\n  if (!text) return \"\";\n  const sentenceEndings = /[.!?](?:\\s|$)/;\n  const match = text.match(sentenceEndings);\n  if (match) {\n    const endIndex = match.index + match[0].length - (match[0].endsWith(\" \") ? 1 : 0);\n    return text.substring(0, endIndex).trim();\n  }\n  return text.length > 150 ? text.substring(0, 150) + \"...\" : text;\n}\nfunction collectScoreDescriptions(transcripts) {\n  const allDescriptions = {};\n  for (const transcript of transcripts) {\n    if (transcript.scoreDescriptions) {\n      for (const [scoreName, description] of Object.entries(transcript.scoreDescriptions)) {\n        if (!allDescriptions[scoreName] && description) {\n          allDescriptions[scoreName] = description;\n        }\n      }\n    }\n  }\n  return allDescriptions;\n}\nfunction createTranscriptDisplay(transcript, filePath) {\n  const targetModel = extractTargetModel(transcript);\n  const pathParts = filePath.split(\"/\");\n  const behaviorDir = pathParts.length > 1 ? pathParts[pathParts.length - 2] : \"\";\n  const fileName = pathParts[pathParts.length - 1];\n  const transcriptNumber = fileName.endsWith(\".json\") ? fileName.slice(0, -5) : fileName;\n  return {\n    id: transcript.metadata.transcript_id || transcriptNumber,\n    model: extractModelName(targetModel),\n    split: behaviorDir,\n    concerningScore: transcript.metadata.judge_output?.scores?.concerning || 0,\n    summary: transcript.metadata.judge_output?.summary || transcript.metadata.description || \"No summary available\",\n    scores: transcript.metadata.judge_output?.scores || {},\n    scoreDescriptions: transcript.metadata.judge_output?.score_descriptions,\n    judgeSummary: transcript.metadata.judge_output?.summary || \"No judgment summary available\",\n    justification: transcript.metadata.judge_output?.justification || \"No justification available\",\n    tags: transcript.metadata.tags || [],\n    systemPrompt: extractSystemPrompt(transcript),\n    transcript,\n    _filePath: filePath\n  };\n}\nexport {\n  extractFirstSentence as a,\n  createTranscriptDisplay as b,\n  collectScoreDescriptions as c,\n  extractModelName as e\n};\n"],"names":[],"mappings":"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"}