{"version":3,"file":"hooks.server-UzO6P2GS.js","sources":["../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { T as TRANSCRIPT_DIR, i as initializeGlobalCache, s as shutdownGlobalCache } from \"./transcript-cache.js\";\nlet cacheInitialized = false;\nasync function initializeCache() {\n  if (cacheInitialized) return;\n  try {\n    console.log(`ðŸš€ [SERVER] Initializing transcript cache for directory: ${TRANSCRIPT_DIR}`);\n    await initializeGlobalCache(TRANSCRIPT_DIR);\n    cacheInitialized = true;\n    console.log(\"âœ… [SERVER] Transcript cache initialized successfully\");\n  } catch (error) {\n    console.error(\"ðŸš¨ [SERVER] Failed to initialize transcript cache:\", error);\n  }\n}\nprocess.on(\"SIGTERM\", async () => {\n  console.log(\"ðŸ›‘ [SERVER] Received SIGTERM, shutting down gracefully...\");\n  await shutdownGlobalCache();\n  process.exit(0);\n});\nprocess.on(\"SIGINT\", async () => {\n  console.log(\"ðŸ›‘ [SERVER] Received SIGINT, shutting down gracefully...\");\n  await shutdownGlobalCache();\n  process.exit(0);\n});\nconst handle = async ({ event, resolve }) => {\n  if (!cacheInitialized) {\n    await initializeCache();\n  }\n  if (event.url.pathname.startsWith(\"/api/\")) {\n    const cache = await import(\"./transcript-cache.js\").then((n) => n.t).then((m) => m.getTranscriptCache());\n    event.locals.cacheStats = cache.getStats();\n  }\n  const response = await resolve(event);\n  if (process.env.NODE_ENV === \"development\" && event.locals.cacheStats) {\n    const stats = event.locals.cacheStats;\n    response.headers.set(\"X-Cache-Metadata-Count\", stats.metadataCount.toString());\n    response.headers.set(\"X-Cache-Transcript-Count\", stats.fullTranscriptCount.toString());\n    response.headers.set(\n      \"X-Cache-Hit-Rate\",\n      stats.cacheHits + stats.cacheMisses > 0 ? (stats.cacheHits / (stats.cacheHits + stats.cacheMisses) * 100).toFixed(1) + \"%\" : \"0%\"\n    );\n  }\n  return response;\n};\nexport {\n  handle\n};\n"],"names":[],"mappings":";;;;;;;;;;AACA,IAAI,gBAAgB,GAAG,KAAK;AAC5B,eAAe,eAAe,GAAG;AACjC,EAAE,IAAI,gBAAgB,EAAE;AACxB,EAAE,IAAI;AACN,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC,yDAAyD,EAAE,cAAc,CAAC,CAAC,CAAC;AAC7F,IAAI,MAAM,qBAAqB,CAAC,cAAc,CAAC;AAC/C,IAAI,gBAAgB,GAAG,IAAI;AAC3B,IAAI,OAAO,CAAC,GAAG,CAAC,sDAAsD,CAAC;AACvE,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,oDAAoD,EAAE,KAAK,CAAC;AAC9E,EAAE;AACF;AACA,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,YAAY;AAClC,EAAE,OAAO,CAAC,GAAG,CAAC,2DAA2D,CAAC;AAC1E,EAAE,MAAM,mBAAmB,EAAE;AAC7B,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;AACF,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,YAAY;AACjC,EAAE,OAAO,CAAC,GAAG,CAAC,0DAA0D,CAAC;AACzE,EAAE,MAAM,mBAAmB,EAAE;AAC7B,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;AACG,MAAC,MAAM,GAAG,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,IAAI,CAAC,gBAAgB,EAAE;AACzB,IAAI,MAAM,eAAe,EAAE;AAC3B,EAAE;AACF,EAAE,IAAI,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;AAC9C,IAAI,MAAM,KAAK,GAAG,MAAM,OAAO,gCAAuB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,kBAAkB,EAAE,CAAC;AAC5G,IAAI,KAAK,CAAC,MAAM,CAAC,UAAU,GAAG,KAAK,CAAC,QAAQ,EAAE;AAC9C,EAAE;AACF,EAAE,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,KAAK,CAAC;AACvC,EAAE,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,IAAI,KAAK,CAAC,MAAM,CAAC,UAAU,EAAE;AACzE,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,UAAU;AACzC,IAAI,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,KAAK,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC;AAClF,IAAI,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,0BAA0B,EAAE,KAAK,CAAC,mBAAmB,CAAC,QAAQ,EAAE,CAAC;AAC1F,IAAI,QAAQ,CAAC,OAAO,CAAC,GAAG;AACxB,MAAM,kBAAkB;AACxB,MAAM,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC,WAAW,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,IAAI,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC,WAAW,CAAC,GAAG,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG;AACnI,KAAK;AACL,EAAE;AACF,EAAE,OAAO,QAAQ;AACjB;;;;"}